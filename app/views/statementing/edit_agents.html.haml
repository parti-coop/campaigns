%section.page-block
  .container
    = render 'statementing/agents_header', active: :edit_agents

    .panel.panel-default
      .panel-heading
        촉구대상 검색하여 추가
      .panel-body
        %p 촉구할 대상을 찾아 보세요.
        = form_tag nil, method: :get do
          = select_tag :action_targets, nil, multiple: true, class: 'form-control gov-action-targets-select', style: 'display: inline;'
          = submit_tag '추가', class: 'btn btn-default'

    .panel.panel-default
      .panel-heading
        현재 촉구대상
      .panel-body
        - if @statementable.agents.empty?
          아직 촉구 중인 대상이 없습니다.
        - if @statementable.dedicated_agents.any?
          %h4 직접 연결된 인물
          .row
            - @statementable.dedicated_agents.each do |agent|
              .col-xs-12.col-sm-4
                .media
                  .media-left
                    = link_to agent_path(agent) do
                      .image.agent-image.agent-image--mini{style: "background-image: url(#{agent.image.xs.url});"}
                  .media-body
                    %strong= agent.name
                    %br
                    = agent.organization
                  .media-right
                    = link_to '연결끊기', polymorphic_path([:remove_agent, @statementable], agent_id: agent.id, q: params[:q]), method: :delete, class: 'btn btn-danger btn-xs text-nowrap'
        - if @statementable.action_targets.any?
          - @statementable.action_targets.to_a.group_by(&:action_assignable_type).each do |action_assignable_type, action_targets|
            %h4 연결된 #{action_assignable_type.classify.safe_constantize.model_name.human}
            .row
              - action_targets.each do |action_target|
                - action_assignable = action_target.action_assignable
                .col-xs-12.col-sm-4
                  .media
                    .media-left
                      = link_to action_assignable do
                        .image.agent-image.agent-image--mini{style: "background-image: url(#{action_assignable.image.xs.url});"}
                    .media-body
                      = link_to action_assignable do
                        %strong= action_assignable.title
                    .media-right
                      = link_to '연결끊기', polymorphic_path([:remove_action_target, @statementable], action_assignable_id: action_assignable.id, action_assignable_type: action_assignable.class.to_s, q: params[:q]), method: :delete, class: 'btn btn-danger btn-xs text-nowrap'
